// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// --- USU√ÅRIOS (JOVENS) ---
model User {
  id            String    @id @default(cuid())
  name          String
  email         String?   @unique
  phone         String?   // Para o l√≠der ligar
  password      String?   // Senha do aluno (Opcional para n√£o quebrar quem j√° existe)
  role          Role      @default(JOVEM)

  // FOTO DE PERFIL (NOVO CAMPO)
  avatar        String    @default("1") // Vamos usar n√∫meros para os avatares (Ex: 1, 2, 3...)

  // Gamifica√ß√£o (A parte divertida)
  xp            Int       @default(0)
  level         Int       @default(1)
  currentStreak Int       @default(0) // A "Chama" üî• (Dias seguidos)
  bestStreak    Int       @default(0) // Recorde pessoal
  lastActivity  DateTime  @default(now())

  // Comunh√£o
  squadId       String?   // A qual "Tribo" pertence
  squad         Squad?    @relation(fields: [squadId], references: [id])

  // Hist√≥rico
  attendances   Attendance[]
  quizResults   QuizResult[]
  notifications Notification[]

  createdAt     DateTime  @default(now())
}

enum Role {
  JOVEM
  LIDER     // Cuida de um esquadr√£o
  PROFESSOR // Cria li√ß√µes
  ADMIN     // Pastor/Voc√™
}

// --- TRIBOS / ESQUADR√ïES ---
model Squad {
  id          String   @id @default(cuid())
  name        String   // Ex: "Tribo de Jud√°", "√Åguias"
  totalXp     Int      @default(0) // Pontua√ß√£o da Tribo (Competi√ß√£o)
  members     User[]
}

// --- EBD E QUIZZES ---
model Lesson {
  id          String   @id @default(cuid())
  title       String   // Ex: "A Import√¢ncia da Ora√ß√£o"
  content     String   // O texto da li√ß√£o
  date        DateTime // Data da aula
  isPublished Boolean  @default(false)

  questions   Question[]
}

model Question {
  id          String   @id @default(cuid())
  lessonId    String
  text        String   // "Quem derrubou as muralhas?"
  optionA     String
  optionB     String
  optionC     String
  optionD     String
  correctOption String // "A", "B", "C" ou "D"
  xpReward    Int      @default(50) // Vale pontos!

  lesson      Lesson   @relation(fields: [lessonId], references: [id])
  results     QuizResult[]
}

model QuizResult {
  id          String   @id @default(cuid())
  userId      String
  questionId  String
  isCorrect   Boolean
  createdAt   DateTime @default(now())

  user        User     @relation(fields: [userId], references: [id])
  question    Question @relation(fields: [questionId], references: [id])
}

// --- PRESEN√áA ---
model Attendance {
  id        String   @id @default(cuid())
  userId    String
  date      DateTime @default(now())
  type      EventType

  user      User     @relation(fields: [userId], references: [id])
}

enum EventType {
  EBD
  QUIZ
  CULTO_DOMINGO
  CULTO_QUINTA
  EVENTO_EXTRA
}

// --- NOTIFICA√á√ïES ---
model Notification {
  id        String   @id @default(cuid())
  userId    String
  title     String   // "Sua chama apagou! üò¢"
  message   String
  read      Boolean  @default(false)
  createdAt DateTime @default(now())

  user      User     @relation(fields: [userId], references: [id])
}